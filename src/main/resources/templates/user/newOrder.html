<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>立即下单 - Express</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}" href="../../static/assets/css/bootstrap.min.css"/>
    <link rel="stylesheet" th:href="@{/assets/css/express.css}" href="../../static/assets/css/express.css"/>
    <link rel="stylesheet" th:href="@{/assets/css/ios-switch.css}" href="../../static/assets/css/ios-switch.css"/>

</head>
<body>
    <div class="container-fluid">
        <!-- 头部 -->
        <nav th:replace="user/module/nav::html"></nav>
        <!-- 主体 -->
        <div class="row">
            <!-- 左侧菜单 -->
            <div th:replace="user/module/sidebar::html"></div>
            <!-- 下单主体 -->
            <div class="col-md-10">
                <h1>创建订单</h1>
                <!--分割线-->
                <HR style="FILTER: alpha(opacity=100,finishopacity=0,style=3)" width="100%" color=#987cb9 SIZE=3>
                <form class="form-horizontal" id="orderForm" method="post" action="/order/sub">
                    <h2>订单信息</h2>
                    <div class="form-group">
                        <label for="inputclientNickname" class="col-sm-1 control-label"><span style="color: red">*</span>客户昵称</label>
                        <div class="col-sm-11">
                            <input type="text" class="form-control input-width" id="inputclientNickname" name="clientNickname" placeholder="请输入客户昵称">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputdeliverName" class="col-sm-1 control-label">收货姓名</label>
                        <div class="col-sm-11">
                            <input type="tel" class="form-control input-width" id="inputdeliverName" name="deliverName" placeholder="收货姓名">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputdeliverPhone" class="col-sm-1 control-label"><span style="color: red;visibility: hidden">*</span>联系电话</label>
                        <div class="col-sm-11">
                            <input type="tel" class="form-control input-width" id="inputdeliverPhone" name="deliverPhone" placeholder="请输入联系电话">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputdeliverAddress" class="col-sm-1 control-label">快递寄达地址</label>
                        <div class="col-sm-11">
                            <textarea class="form-control dis_change_textarea" id="inputdeliverAddress" name="deliverAddress" rows="5"
                                      placeholder="此地址为客户收货地址"></textarea>
                        </div>
                    </div>

                    <!--分割线-->
                    <HR style="FILTER: alpha(opacity=100,finishopacity=0,style=3)" width="100%" color=#987cb9 SIZE=3>
                    <h2>商品信息</h2>
                    <div class="form-group">
                        <label for="inputheadName" class="col-sm-1 control-label"><span style="color: red;visibility: visible">*</span>娃头名称</label>
                        <div class="col-sm-11">
                            <input type="tel" class="form-control input-width" id="inputheadName" name="typeName" placeholder="娃头名称">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputheadFen" class="col-sm-1 control-label"><span style="color: red;visibility: visible">*</span>几分娃头</label>
                        <div class="col-sm-11">
                            <input type="tel" class="form-control input-width" id="inputheadFen" name="fen" placeholder="几分娃头">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputCount" class="col-sm-1 control-label"><span style="color: red;visibility: visible">*</span>娃头数量</label>
                        <div class="col-sm-11">
                            <input type="tel"  class="form-control input-width" id="inputCount" name="count" placeholder="娃头数量" value="1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputtypeId" class="col-sm-1 control-label">投妆类型</label>
                        <div class="col-sm-11">
                            <select name="typeId" id="inputtypeId" class="form-control input-width">
                                <option value="0">--请选择投妆类型--</option>
                                <option th:each="orderType : ${T(com.example.express.domain.enums.OrderTypeEnum).values()}"
                                        th:value="${orderType.value}"
                                        th:text="${orderType.code}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputplatform" class="col-sm-1 control-label">下单平台</label>
                        <div class="col-sm-11">
                            <select name="platform" id="inputplatform" class="form-control input-width">
                                <option value="0">--请选择下单平台--</option>
                                <option th:each="platform : ${T(com.example.express.domain.enums.PlatformsEnum).values()}"
                                        th:value="${platform.value}"
                                        th:text="${platform.code}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputreceivePostNumber" class="col-sm-1 control-label"><span style="color: red;visibility: hidden">*</span>娃头物流单号</label>
                        <div class="col-sm-11">
                            <input type="tel" class="form-control input-width" id="inputreceivePostNumber" name="receivePostNumber" placeholder="请输入娃头物流单号">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputextraPrice" class="col-sm-1 control-label"><span style="color: red;visibility: hidden">*</span>额外价格</label>
                        <div class="col-sm-11">
                            <input type="tel" class="form-control input-width" id="inputextraPrice" name="extraPrice" placeholder="额外价格">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputorderDemand" class="col-sm-1 control-label">投妆需求</label>
                        <div class="col-sm-11">
                            <textarea class="form-control dis_change_textarea" id="inputorderDemand" name="orderDemand" rows="5"
                                      placeholder="投妆需求"></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="inputRemark" class="col-sm-1 control-label">订单备注</label>
                        <div class="col-sm-11">
                            <textarea class="form-control dis_change_textarea" id="inputRemark" name="remark" rows="5"
                                      placeholder="如果有特殊要求，请备注于此"></textarea>
                        </div>
                    </div>
                    <!--加急按钮-->
                    <div class="form-group">
                        <label for="inputUrgent" class="col-sm-1 control-label">加急</label>
                        <div class="col-sm-11">
                            <input class="ios-switch ios-switch-anim" type="checkbox" id="inputUrgent" name="urgent">
                        </div>
                    </div>

                    <!--分割线-->
                    <HR style="FILTER: alpha(opacity=100,finishopacity=0,style=3)" width="100%" color=#987cb9 SIZE=3>
                    <div class="form-group">
                        <label for="inputVerify" class="col-sm-1 control-label">验证码</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control input-width" id="inputVerify" name="verify" placeholder="请输入验证码">
                        </div>
                        <div class="col-sm-5" style="margin-top: 10px">
                            <img id="verifyCode" src="/auth/code/getVerifyCode" title="看不清，请点我" onclick="refresh(this)"
                                 onmouseover="mouseover(this)"/>
                        </div>
                    </div>
                    <div class="form-group" style="text-align: center">
                        <button class="btn btn-primary" type="submit">前往支付</button>
                        <button class="btn btn-warning" type="reset">重新填写</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script th:src="@{/assets/js/http.js}" src="../../static/assets/js/http.js"></script>
    <script th:src="@{/assets/js/express.js}" src="../../static/assets/js/express.js"></script>
    <script th:src="@{/assets/js/jquery.min.js}" src="../../static/assets/js/jquery.min.js"></script>
    <script th:src="@{/assets/js/jquery.validate.min.js}" src="../../static/assets/js/jquery.validate.min.js"></script>
    <script th:src="@{/assets/layer/layer.js}" src="../../static/assets/layer/layer.js"></script>
    <script th:src="@{/assets/js/bootstrap.min.js}" src="../../static/assets/js/bootstrap.min.js"></script>
    <script>

        // Place the refactored JavaScript code here
        function populatePlatforms() {
            $.ajax({
                type: "GET",
                url: "/api/v1/order/getPlatforms",
                success: function(platforms) {
                    // Clear existing options
                    $("#inputplatform").empty();

                    // Append new options based on returned platforms
                    platforms.forEach(function(platform) {
                        $("#inputplatform").append(
                            $("<option></option>")
                                .attr("value", platform.code)
                                .text(platform.name)
                        );
                    });
                },
                error: function() {
                    console.error("Failed to retrieve platforms");
                }
            });
        }

        $(document).ready(function() {
            // 将填充平台选项的函数绑定到<select>元素的change事件上
            $("#inputplatform").on('change', function() {
                // 当<select>元素的值发生变化时执行的操作
                var selectedValue = $(this).val();
                console.log("选中的值:", selectedValue);
            });
        });

        $(function () {
            $("#newOrder-sidebar").addClass('active');

            // 加载快递公司数据
            sendJson(HTTP.GET, "/api/v1/public/company", null, false, function (res) {
                if (res.code === 0) {
                    let html = '', data = res.data;
                    for(let i = 0; i<data.length; i++) {
                        html += '<option value="'+data[i].id+'">'+data[i].name+ ' | ' + data[i].code + '</option>\n';
                    }
                    $("#inputCompany").html(html);
                } else {
                    layer.msg(res.msg, {icon: 2});
                }
            }, function () {
                layer.msg("未知错误", {icon: 2});
            });
        });

        function refresh(obj) { obj.src = "/auth/code/getVerifyCode?" + Math.random(); }



        function mouseover(obj) { obj.style.cursor = "pointer"; }

        $().ready(function() {
            $("#orderForm").validate({
                rules: {
                    recName: {
                        required: true,
                        maxlength: 64
                    },
                    recTel: {
                        required: true,
                        minlength: 11
                    },
                    recAddress: {
                        required: true,
                        maxlength: 255
                    },
                    address: {
                        required: true,
                        maxlength: 255
                    },
                    odd: {
                        required: true,
                        maxlength: 128
                    },
                    company: {
                        required: true
                    },
                    remark: {
                        maxlength: 255
                    },
                    verify: "required"
                },
                messages: {
                    recName: {
                        required: "取件姓名不能为空",
                        maxlength: "取件姓名超过限制长度"
                    },
                    recTel: {
                        required: "联系电话不能为空",
                        minlength: "手机号码不少于11位"
                    },
                    recAddress: {
                        required: "收件地址不能为空",
                        maxlength: "收件地址超过限制长度"
                    },
                    address: {
                        required: "快递寄达地址不能为空",
                        maxlength: "快递寄达地址超过限制长度"
                    },
                    odd: {
                        required: "快递单号不能为空",
                        maxlength: "快递单号超过限制长度"
                    },
                    company: {
                        required: "快递公司不能为空"
                    },
                    remark: {
                        maxlength: "憋住超过限制长度"
                    },
                    verify: "验证码不能为空"
                },
                submitHandler: function (form) {
                    sendJson(HTTP.POST, "/auth/code/check-img", {"code": $("#inputVerify").val()}, false, function (res) {
                        if (res.code !== 0) {
                            layer.msg(res.msg,{icon:2});
                        } else {
                            form.submit();
                        }
                    }, function () {
                        layer.msg("未知错误",{icon:2});
                    });
                }
            });
        });
    </script>
</body>
</html>